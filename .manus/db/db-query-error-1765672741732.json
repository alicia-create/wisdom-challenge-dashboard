{
  "query": "-- Performance Optimization Indexes\n-- Created: 2025-12-13\n-- Purpose: Improve query performance for frequently accessed columns\n\n-- ============================================\n-- CONTACTS TABLE INDEXES\n-- ============================================\n\n-- Index for date range queries (most frequent operation)\nCREATE INDEX IF NOT EXISTS idx_contacts_created_at \nON contacts(created_at DESC);\n\n-- Index for manychat_id filtering (used in ManyChat bot users count)\nCREATE INDEX IF NOT EXISTS idx_contacts_manychat_id \nON contacts(manychat_id) \nWHERE manychat_id IS NOT NULL;\n\n-- Composite index for wisdom funnel queries (id + created_at)\nCREATE INDEX IF NOT EXISTS idx_contacts_id_created_at \nON contacts(id, created_at DESC);\n\n-- ============================================\n-- ORDERS TABLE INDEXES\n-- ============================================\n\n-- Index for date range queries\nCREATE INDEX IF NOT EXISTS idx_orders_created_at \nON orders(created_at DESC);\n\n-- Index for contact_id JOIN operations\nCREATE INDEX IF NOT EXISTS idx_orders_contact_id \nON orders(contact_id);\n\n-- Index for VIP sales filtering (order_total >= 31)\nCREATE INDEX IF NOT EXISTS idx_orders_order_total \nON orders(order_total);\n\n-- Composite index for wisdom funnel VIP queries (contact_id + order_total + created_at)\nCREATE INDEX IF NOT EXISTS idx_orders_contact_order_total_date \nON orders(contact_id, order_total, created_at DESC) \nWHERE order_total >= 31;\n\n-- Index for high-ticket sales (order_total >= 1000)\nCREATE INDEX IF NOT EXISTS idx_orders_high_ticket \nON orders(order_total, purchase_date DESC) \nWHERE order_total >= 1000;\n\n-- ============================================\n-- AD_PERFORMANCE TABLE INDEXES\n-- ============================================\n\n-- Index for date range queries (most frequent)\nCREATE INDEX IF NOT EXISTS idx_ad_performance_date \nON ad_performance(date DESC);\n\n-- Index for platform filtering (Meta/Google)\nCREATE INDEX IF NOT EXISTS idx_ad_performance_platform \nON ad_performance(platform);\n\n-- Index for campaign name filtering (case-insensitive)\n-- Using trigram index for ILIKE queries\nCREATE EXTENSION IF NOT EXISTS pg_trgm;\nCREATE INDEX IF NOT EXISTS idx_ad_performance_campaign_name_trgm \nON ad_performance USING gin(campaign_name gin_trgm_ops);\n\n-- Composite index for platform + date queries\nCREATE INDEX IF NOT EXISTS idx_ad_performance_platform_date \nON ad_performance(platform, date DESC);\n\n-- Index for campaign hierarchy queries\nCREATE INDEX IF NOT EXISTS idx_ad_performance_campaign_id \nON ad_performance(campaign_id);\n\nCREATE INDEX IF NOT EXISTS idx_ad_performance_adset_id \nON ad_performance(adset_id);\n\nCREATE INDEX IF NOT EXISTS idx_ad_performance_ad_id \nON ad_performance(ad_id);\n\n-- ============================================\n-- ANALYTICS_EVENTS TABLE INDEXES\n-- ============================================\n\n-- Index for contact_id JOIN operations\nCREATE INDEX IF NOT EXISTS idx_analytics_events_contact_id \nON analytics_events(contact_id);\n\n-- Index for event name filtering\nCREATE INDEX IF NOT EXISTS idx_analytics_events_name \nON analytics_events(name);\n\n-- Index for funnel filtering (wisdom challenge events)\nCREATE INDEX IF NOT EXISTS idx_analytics_events_funnel \nON analytics_events(funnel);\n\n-- Composite index for contact activity queries\nCREATE INDEX IF NOT EXISTS idx_analytics_events_contact_timestamp \nON analytics_events(contact_id, timestamp DESC);\n\n-- Trigram index for comment/value search\nCREATE INDEX IF NOT EXISTS idx_analytics_events_comment_trgm \nON analytics_events USING gin(comment gin_trgm_ops);\n\nCREATE INDEX IF NOT EXISTS idx_analytics_events_value_trgm \nON analytics_events USING gin(value gin_trgm_ops);\n\n-- ============================================\n-- ORDER_ITEMS TABLE INDEXES\n-- ============================================\n\n-- Index for product_id filtering (Kingdom Seeker Trials)\nCREATE INDEX IF NOT EXISTS idx_order_items_product_id \nON order_items(product_id);\n\n-- Index for order_id JOIN operations\nCREATE INDEX IF NOT EXISTS idx_order_items_order_id \nON order_items(order_id);\n\n-- Composite index for product filtering with order join\nCREATE INDEX IF NOT EXISTS idx_order_items_product_order \nON order_items(product_id, order_id);\n\n-- ============================================\n-- PRODUCTS TABLE INDEXES\n-- ============================================\n\n-- Index for product name search\nCREATE INDEX IF NOT EXISTS idx_products_name \nON products(name);\n\n-- ============================================\n-- WORKFLOW_ERRORS TABLE INDEXES\n-- ============================================\n\n-- Index for workflow_name filtering\nCREATE INDEX IF NOT EXISTS idx_workflow_errors_workflow_name \nON workflow_errors(workflow_name);\n\n-- Index for error_timestamp queries\nCREATE INDEX IF NOT EXISTS idx_workflow_errors_timestamp \nON workflow_errors(error_timestamp DESC);\n\n-- Composite index for workflow error queries\nCREATE INDEX IF NOT EXISTS idx_workflow_errors_workflow_timestamp \nON workflow_errors(workflow_name, error_timestamp DESC);\n\n-- ============================================\n-- PERFORMANCE STATISTICS\n-- ============================================\n\n-- Update table statistics for query planner\nANALYZE contacts;\nANALYZE orders;\nANALYZE ad_performance;\nANALYZE analytics_events;\nANALYZE order_items;\nANALYZE products;\nANALYZE workflow_errors;",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2j9rVuZuRurkhgi.64ac36f98b86 --database DEFt9ARHDVCZprKAKnwLBw --execute -- Performance Optimization Indexes\n-- Created: 2025-12-13\n-- Purpose: Improve query performance for frequently accessed columns\n\n-- ============================================\n-- CONTACTS TABLE INDEXES\n-- ============================================\n\n-- Index for date range queries (most frequent operation)\nCREATE INDEX IF NOT EXISTS idx_contacts_created_at \nON contacts(created_at DESC);\n\n-- Index for manychat_id filtering (used in ManyChat bot users count)\nCREATE INDEX IF NOT EXISTS idx_contacts_manychat_id \nON contacts(manychat_id) \nWHERE manychat_id IS NOT NULL;\n\n-- Composite index for wisdom funnel queries (id + created_at)\nCREATE INDEX IF NOT EXISTS idx_contacts_id_created_at \nON contacts(id, created_at DESC);\n\n-- ============================================\n-- ORDERS TABLE INDEXES\n-- ============================================\n\n-- Index for date range queries\nCREATE INDEX IF NOT EXISTS idx_orders_created_at \nON orders(created_at DESC);\n\n-- Index for contact_id JOIN operations\nCREATE INDEX IF NOT EXISTS idx_orders_contact_id \nON orders(contact_id);\n\n-- Index for VIP sales filtering (order_total >= 31)\nCREATE INDEX IF NOT EXISTS idx_orders_order_total \nON orders(order_total);\n\n-- Composite index for wisdom funnel VIP queries (contact_id + order_total + created_at)\nCREATE INDEX IF NOT EXISTS idx_orders_contact_order_total_date \nON orders(contact_id, order_total, created_at DESC) \nWHERE order_total >= 31;\n\n-- Index for high-ticket sales (order_total >= 1000)\nCREATE INDEX IF NOT EXISTS idx_orders_high_ticket \nON orders(order_total, purchase_date DESC) \nWHERE order_total >= 1000;\n\n-- ============================================\n-- AD_PERFORMANCE TABLE INDEXES\n-- ============================================\n\n-- Index for date range queries (most frequent)\nCREATE INDEX IF NOT EXISTS idx_ad_performance_date \nON ad_performance(date DESC);\n\n-- Index for platform filtering (Meta/Google)\nCREATE INDEX IF NOT EXISTS idx_ad_performance_platform \nON ad_performance(platform);\n\n-- Index for campaign name filtering (case-insensitive)\n-- Using trigram index for ILIKE queries\nCREATE EXTENSION IF NOT EXISTS pg_trgm;\nCREATE INDEX IF NOT EXISTS idx_ad_performance_campaign_name_trgm \nON ad_performance USING gin(campaign_name gin_trgm_ops);\n\n-- Composite index for platform + date queries\nCREATE INDEX IF NOT EXISTS idx_ad_performance_platform_date \nON ad_performance(platform, date DESC);\n\n-- Index for campaign hierarchy queries\nCREATE INDEX IF NOT EXISTS idx_ad_performance_campaign_id \nON ad_performance(campaign_id);\n\nCREATE INDEX IF NOT EXISTS idx_ad_performance_adset_id \nON ad_performance(adset_id);\n\nCREATE INDEX IF NOT EXISTS idx_ad_performance_ad_id \nON ad_performance(ad_id);\n\n-- ============================================\n-- ANALYTICS_EVENTS TABLE INDEXES\n-- ============================================\n\n-- Index for contact_id JOIN operations\nCREATE INDEX IF NOT EXISTS idx_analytics_events_contact_id \nON analytics_events(contact_id);\n\n-- Index for event name filtering\nCREATE INDEX IF NOT EXISTS idx_analytics_events_name \nON analytics_events(name);\n\n-- Index for funnel filtering (wisdom challenge events)\nCREATE INDEX IF NOT EXISTS idx_analytics_events_funnel \nON analytics_events(funnel);\n\n-- Composite index for contact activity queries\nCREATE INDEX IF NOT EXISTS idx_analytics_events_contact_timestamp \nON analytics_events(contact_id, timestamp DESC);\n\n-- Trigram index for comment/value search\nCREATE INDEX IF NOT EXISTS idx_analytics_events_comment_trgm \nON analytics_events USING gin(comment gin_trgm_ops);\n\nCREATE INDEX IF NOT EXISTS idx_analytics_events_value_trgm \nON analytics_events USING gin(value gin_trgm_ops);\n\n-- ============================================\n-- ORDER_ITEMS TABLE INDEXES\n-- ============================================\n\n-- Index for product_id filtering (Kingdom Seeker Trials)\nCREATE INDEX IF NOT EXISTS idx_order_items_product_id \nON order_items(product_id);\n\n-- Index for order_id JOIN operations\nCREATE INDEX IF NOT EXISTS idx_order_items_order_id \nON order_items(order_id);\n\n-- Composite index for product filtering with order join\nCREATE INDEX IF NOT EXISTS idx_order_items_product_order \nON order_items(product_id, order_id);\n\n-- ============================================\n-- PRODUCTS TABLE INDEXES\n-- ============================================\n\n-- Index for product name search\nCREATE INDEX IF NOT EXISTS idx_products_name \nON products(name);\n\n-- ============================================\n-- WORKFLOW_ERRORS TABLE INDEXES\n-- ============================================\n\n-- Index for workflow_name filtering\nCREATE INDEX IF NOT EXISTS idx_workflow_errors_workflow_name \nON workflow_errors(workflow_name);\n\n-- Index for error_timestamp queries\nCREATE INDEX IF NOT EXISTS idx_workflow_errors_timestamp \nON workflow_errors(error_timestamp DESC);\n\n-- Composite index for workflow error queries\nCREATE INDEX IF NOT EXISTS idx_workflow_errors_workflow_timestamp \nON workflow_errors(workflow_name, error_timestamp DESC);\n\n-- ============================================\n-- PERFORMANCE STATISTICS\n-- ============================================\n\n-- Update table statistics for query planner\nANALYZE contacts;\nANALYZE orders;\nANALYZE ad_performance;\nANALYZE analytics_events;\nANALYZE order_items;\nANALYZE products;\nANALYZE workflow_errors;",
  "returncode": 1,
  "logs": [
    "ERROR 1146 (42S02) at line 10: Table 'deft9arhdvczprkaknwlbw.contacts' doesn't exist"
  ]
}